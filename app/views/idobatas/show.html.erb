<div class="page-header">
	<h1>
		<%= @idobata.name %>
	</h1>
</div>

<div class="row">
<div class="col-xs-8">
<div class="panel panel-primary">
	<div class="panel-heading">
		<div class="panel-title">主催者</div>
	</div>
	<div class="panel-body">
		<% if @idobata.user %>
		<%= @idobata.user.name %>
		<% else %>
		退会したユーザーです
		<% end %>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		開催時間
	</div>
	<div class="panel-body">
		<%= @idobata.start_time.strftime('%Y/%m/%D %H:%M') %> - <%= @idobata.end_time.strftime('%Y/%m/%D %H:%M') %>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		開催場所
	</div>
	<div class="panel-body">
		<%= @idobata.place %>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		イベント内容
	</div>
	<div class="panel-body">
		<%= @idobata.content %>
	</div>
</div>
</div>
<div class="col-xs-4">
	<% if @idobata.created_by?(current_user) %>
		<%= link_to 'イベントを編集する', edit_idobata_path(@idobata), class: 'btn btn-info btn-lg btn-block' %>
		<%= link_to 'イベントを削除する', idobata_path(@idobata), class: 'btn btn-danger btn-lg btn-block', method: :delete, data: { confirm: '本当に削除いたしますか？'} %>
	<% end %>
	<% if @ticket %>
		<%= link_to '参加をキャンセルする', idobata_ticket_path(@idobata, @ticket), method: :delete, class: "btn btn-warning btn-lg btn-block" %>
	<% elsif user_signed_in? %>
		<button class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#createTicket">
			参加する
		</button>
		<div class="modal fade" id="createTicket" tabindex="-1" role="dialog" aria-labelledby="dialogHeader" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="dialogHeader">参加コメント</h4>
					</div>
					<%= form_for(@idobata.tickets.build, url: idobata_tickets_path(@idobata), remote: true) do |f| %>
						<div class="modal-body">
							<%= f.text_field :comment, class: 'form-control' %>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">キャンセル</button>
							<%= f.button '送信', class: "btn btn-primary", data: { disable_with: '送信中…' } %>
						</div>
					<% end %>
				</div>
			</div>
		</div>

	<% else %>
	 <%= link_to '参加する', new_idobata_ticket_path(@idobata), class: "btn btn-primary btn-lg btn-block" %>
	<% end %>
	<hr>
		<div class="panel panel-default">
			<div class="panel-heading">
				参加者
			</div>
			<div class="panel-body">
				<ul class="list-unstyled">
					<% @tickets.each do |ticket| %>
						<% if ticket.user %>
						<li>
							<%= ticket.user.name %>
							<%= ticket.comment %>
						</li>
						<% else %>
						退会したユーザーです
						<% end %>
					<% end %>
				</ul>
			</div>
		</div>	
	</div>
</div>
